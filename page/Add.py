import streamlit as st
from .backend import Session_state
from .backend.Databased import Base


# –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –≤ –±–∞–∑—É. –ü–∞—Ä—Å–∏–Ω–≥ –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –±—É–¥–µ—Ç –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ
# –ø–∞—É–∫–∞.
def main():
    Session_state()
    urls = Base().read_url(table=st.session_state.option)
    st.markdown('''
    –ù–∏–∂–µ –≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ –≤–∏–¥–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã. 
    <p> 
    –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ —Å—Å—ã–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –≤–∏–¥–∞: —Å—Å—ã–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ 
    –∫–∞—Ä—Ç–æ—á–∫—É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏. –°—Å—ã–ª–∫–∞ –Ω–∞ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç–µ, –Ω–∞ —Ç–æ—á–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ –∏ —Ç.–¥. –Ω–µ –±—É–¥—É—Ç –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–æ–π.
    <p> 
    –°—Å—ã–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å –≤–∏–¥–∞ <i> https://yandex.ru/maps/org/</i>.
    ''', unsafe_allow_html=True)
    with st.form("my_form"):
        title = st.text_input('–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É')
        submitted = st.form_submit_button("–û—Ç–ø—Ä–∞–≤–∏—Ç—å")
        if submitted:
            count = 0
            # –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å—Å—ã–ª–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–≤–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ - –µ—Å—Ç—å –ª–∏ –≤ —Å—Å—ã–ª–∫–µ maps –∏ yandex, —Ç.–µ. –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –ª–∏ —Å—Å—ã–ª–∫–∞
            # –∫ —è–Ω–¥–µ–∫—Å–æ–≤—Å–∫–∏–º –∫–∞—Ä—Ç–∞–º –∏–ª–∏ –Ω–µ—Ç. –ê —Ç–∞–∫–∂–µ –∏–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–π —Å—Å—ã–ª–∫–∏ –≤ –Ω–∞—à–µ–º
            # —Å–ø–∏—Å–∫–µ –ø—Ä–æ–µ–∫—Ç–æ–≤. –ò–¥–µ—è - –∫–ª–∞—Å—Å, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è - —Ö–µ—Ä–Ω—è) –¢.–∫. –≤—Ä—è–¥–ª–∏ –º—ã –ø–æ–ª—É—á–∏–º –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç
            # –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - –¥–∞–∂–µ zoom –∫–∞—Ä—Ç—ã –º–µ–Ω—è–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã. –¢–æ–ª—å–∫–æ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ —Ä–µ—Å—É—Ä—Å –æ—Ç–¥–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
            if '/maps/' in title and '/yandex.' in title:
                # –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ–±—ã —Å—Å—ã–ª–∫–∞ —Å—Å—ã–ª–∞–ª–∞—Å—å –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –∏–º–µ–Ω–Ω–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, —Ç.–µ. maps/org/
                if '/org/' in title:
                    ll = title.split('ll=')[1].split('%2C')[0]
                    tt = title.split('ll=')[1].split('%2C')[1].split('&')[0]
                    for item in urls:
                        if ll in item and tt in item:
                            count = 1
                            break
                    if count == 1:
                        st.error('–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —É–∂–µ –µ—Å—Ç—å –≤ –±–∞–∑–µ', icon="üö®")
                    else:
                        Base().create_new_url(table=st.session_state.option, url=title)
                        st.success('–°—Å—ã–ª–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –±–∞–∑—É!', icon="‚úÖ")
                else:
                    st.error('–°—Å—ã–ª–∫–∞ –Ω–µ –≤–µ–¥–µ—Ç –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏', icon="üö®")
            else:
                st.error('–≠—Ç–æ –Ω–µ —Å—Å—ã–ª–∫–∞ –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã', icon="üö®")


if __name__ == '__main__':
    main()
